<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Remove or flags groups or clients that have less than some number of rows or some number of distinct values in a variable. For example, it can be used to remove clients that had less than n visits to some service on different dates from some administrative records. It offers filtering with dplyr::n_distinct() functionality for database input."><title>Removes or flags groups with n less than some number — restrict_n • healthdb</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Removes or flags groups with n less than some number — restrict_n"><meta property="og:description" content="Remove or flags groups or clients that have less than some number of rows or some number of distinct values in a variable. For example, it can be used to remove clients that had less than n visits to some service on different dates from some administrative records. It offers filtering with dplyr::n_distinct() functionality for database input."><meta property="og:image" content="https://kevinhzq.github.io/healthdb/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">healthdb</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/healthdb.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/KevinHzq/healthdb/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Removes or flags groups with n less than some number</h1>
      <small class="dont-index">Source: <a href="https://github.com/KevinHzq/healthdb/blob/HEAD/R/restrict_n.R" class="external-link"><code>R/restrict_n.R</code></a></small>
      <div class="d-none name"><code>restrict_n.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Remove or flags groups or clients that have less than some number of rows or some number of distinct values in a variable. For example, it can be used to remove clients that had less than n visits to some service on different dates from some administrative records. It offers filtering with <code><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">dplyr::n_distinct()</a></code> functionality for database input.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">restrict_n</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">clnt_id</span>,</span>
<span>  <span class="va">n_per_clnt</span>,</span>
<span>  count_by <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"flag"</span>, <span class="st">"filter"</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"healthdb.verbose"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>Data.frames or remote tables (e.g., from <code><a href="https://dbplyr.tidyverse.org/reference/tbl_sql.html" class="external-link">dbplyr::tbl_sql()</a></code>)</p></dd>


<dt>clnt_id</dt>
<dd><p>Grouping variable (quoted/unquoted).</p></dd>


<dt>n_per_clnt</dt>
<dd><p>A single number specifying the minimum number of group size.</p></dd>


<dt>count_by</dt>
<dd><p>Another variable dictating the counting unit of <code>n_per_clnt.</code> The default is NULL meaning the inclusion criteria is the number of row, i.e., <code>dplyr::n() &gt;= n_per_clnt</code>. If it is not NULL, the criteria becomes equivalent to <code>dplyr::n_distinct(count_by) &gt;= n_per_clnt</code>.</p></dd>


<dt>mode</dt>
<dd><p>Either "flag" - add a new column 'flag_restrict_n' indicating if the client met the condition (all rows from a qualified client would have flag = 1), or "filter" - remove clients that did not meet the condition from the data. Default is "flag".</p></dd>


<dt>verbose</dt>
<dd><p>A logical for whether to explain the query and report how many groups were removed. Default is fetching from options. Use <code>options(healthdb.verbose = FALSE)</code> to suppress once and for all. Reporting is not for remote tables as the query is not executed immediately, thus no result is available for summary without adding an extra run (may be slow) of the query.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A subset of input data satisfied the group size requirement, or raw input data with an new flag column.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">dplyr::n()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/n_distinct.html" class="external-link">dplyr::n_distinct()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># flag cyl groups with less than 8 cars</span></span></span>
<span class="r-in"><span><span class="fu">restrict_n</span><span class="op">(</span><span class="va">mtcars</span>, clnt_id <span class="op">=</span> <span class="va">cyl</span>, n_per_clnt <span class="op">=</span> <span class="fl">8</span>, mode <span class="op">=</span> <span class="st">"flag"</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">ℹ</span> Of the 3 clients in the input, 1 were flagged as 0 by restricting that each client must have at least 8 records </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    mpg cyl disp  hp drat    wt  qsec vs am gear carb flag_restrict_n</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4               0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4               0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1               0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1               0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#remove cyl groups with less than 2 types of gear boxes</span></span></span>
<span class="r-in"><span><span class="fu">restrict_n</span><span class="op">(</span><span class="va">mtcars</span>, clnt_id <span class="op">=</span> <span class="va">cyl</span>, n_per_clnt <span class="op">=</span> <span class="fl">3</span>, count_by <span class="op">=</span> <span class="va">gear</span>, mode <span class="op">=</span> <span class="st">"filter"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">ℹ</span> Of the 3 clients in the input, 1 were excluded by restricting that each client must have at least 3 records with distinct gear</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     mpg cyl  disp  hp drat    wt  qsec vs am gear carb flag_restrict_n</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12 30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14 21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15 27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16 26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17 30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18 21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2               1</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kevin Hu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

