<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Pool qualified clients from results of multiple definitions — pool_case • healthdb</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Pool qualified clients from results of multiple definitions — pool_case"><meta name="description" content="This function filters and pools, i.e., row bind, qualified clients/groups from different source with an option to summarize by client. Unlike bind_source(), no need to supply variable names; the function will guess what should be included and their names from the supplied definition from build_def(). Whether a client is qualified relies on the flag variables set by define_case(). Therefore, this function is intended to be use only with the built-in define_case() as def_fn in build_def()."><meta property="og:description" content="This function filters and pools, i.e., row bind, qualified clients/groups from different source with an option to summarize by client. Unlike bind_source(), no need to supply variable names; the function will guess what should be included and their names from the supplied definition from build_def(). Whether a client is qualified relies on the flag variables set by define_case(). Therefore, this function is intended to be use only with the built-in define_case() as def_fn in build_def()."><meta property="og:image" content="https://kevinhzq.github.io/healthdb/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">healthdb</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/healthdb.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/KevinHzq/healthdb/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Pool qualified clients from results of multiple definitions</h1>
      <small class="dont-index">Source: <a href="https://github.com/KevinHzq/healthdb/blob/v0.4.0/R/pool_case.R" class="external-link"><code>R/pool_case.R</code></a></small>
      <div class="d-none name"><code>pool_case.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function filters and pools, i.e., row bind, qualified clients/groups from different source with an option to summarize by client. Unlike <code><a href="bind_source.html">bind_source()</a></code>, no need to supply variable names; the function will guess what should be included and their names from the supplied definition from <code><a href="build_def.html">build_def()</a></code>. Whether a client is qualified relies on the flag variables set by <code><a href="define_case.html">define_case()</a></code>. Therefore, this function is intended to be use only with the built-in <code><a href="define_case.html">define_case()</a></code> as <code>def_fn</code> in <code><a href="build_def.html">build_def()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pool_case</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">def</span>,</span>
<span>  output_lvl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"raw"</span>, <span class="st">"clnt"</span><span class="op">)</span>,</span>
<span>  include_src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"has_valid"</span>, <span class="st">"n_per_clnt"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A list of data.frame or remote table which should be output from <code><a href="execute_def.html">execute_def()</a></code>.</p></dd>


<dt id="arg-def">def<a class="anchor" aria-label="anchor" href="#arg-def"></a></dt>
<dd><p>A tibble of case definition generated by <code><a href="build_def.html">build_def()</a></code>.</p></dd>


<dt id="arg-output-lvl">output_lvl<a class="anchor" aria-label="anchor" href="#arg-output-lvl"></a></dt>
<dd><p>Either:</p><ul><li><p>"raw" - output all records (default),</p></li>
<li><p>or "clnt" - output one record per client with summaries including date and source of the first valid record ('first_valid_date/src'), and the latest record ('last_entry_date/src'). Source-specific record counts are also provided (see the return section).</p></li>
</ul></dd>


<dt id="arg-include-src">include_src<a class="anchor" aria-label="anchor" href="#arg-include-src"></a></dt>
<dd><p>Character. It determines records from which sources should be included. This matters when clients were identified only from, not all, but some of the sources. This choice will not impact the number of client that would be identified but has impact on the number of records and the latest entry date. The options are one of:</p><ul><li><p>"all" - records from all sources are included;</p></li>
<li><p>"has_valid" - for each client, records from sources that contain at least one valid record are included;</p></li>
<li><p>"n_per_clnt" - for each client, if they had fewer than <code>n_per_clnt</code> records in a source (see <code><a href="restrict_n.html">restrict_n()</a></code>), then records from that source are removed.</p></li>
</ul></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passing to <code><a href="bind_source.html">bind_source()</a></code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data.frame or remote table with clients that satisfied the predefined case definition. Columns started with "raw_in_" are source-specific counts of raw records, and columns started with "valid_in_" are the number of valid entries (or the number of flags) in each source.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># toy data</span></span></span>
<span class="r-in"><span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="make_test_dat.html">make_test_dat</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="make_test_dat.html">make_test_dat</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use build_def to make a toy definition</span></span></span>
<span class="r-in"><span><span class="va">sud_def</span> <span class="op">&lt;-</span> <span class="fu"><a href="build_def.html">build_def</a></span><span class="op">(</span><span class="st">"SUD"</span>, <span class="co"># usually a disease name</span></span></span>
<span class="r-in"><span>  src_lab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"src1"</span>, <span class="st">"src2"</span><span class="op">)</span>, <span class="co"># identify from multiple sources, e.g., hospitalization, ED visits.</span></span></span>
<span class="r-in"><span>  <span class="co"># functions that filter the data with some criteria</span></span></span>
<span class="r-in"><span>  def_fn <span class="op">=</span> <span class="va">define_case</span>,</span></span>
<span class="r-in"><span>  fn_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    vars <span class="op">=</span> <span class="fu">starts_with</span><span class="op">(</span><span class="st">"diagx"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    match <span class="op">=</span> <span class="st">"start"</span>, <span class="co"># "start" will be applied to all sources as length = 1</span></span></span>
<span class="r-in"><span>    vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"304"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"305"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    clnt_id <span class="op">=</span> <span class="st">"clnt_id"</span>, <span class="co"># list()/c() could be omitted for single element</span></span></span>
<span class="r-in"><span>    <span class="co"># c() can be used in place of list</span></span></span>
<span class="r-in"><span>    <span class="co"># if this argument only takes one value for each source</span></span></span>
<span class="r-in"><span>    n_per_clnt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># save the definition for re-use</span></span></span>
<span class="r-in"><span><span class="co"># saveRDS(sud_def, file = some_path)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># execute definition</span></span></span>
<span class="r-in"><span><span class="va">sud_by_src</span> <span class="op">&lt;-</span> <span class="va">sud_def</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu"><a href="execute_def.html">execute_def</a></span><span class="op">(</span>with_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>src1 <span class="op">=</span> <span class="va">df1</span>, src2 <span class="op">=</span> <span class="va">df2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Actions for definition SUD using source df1:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → --------------Inclusion step--------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">ℹ</span> Identify records with condition(s):</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> where at least one of the diagx, diagx_1, diagx_2 column(s) in each record</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> contains a value satisfied regular expression: ^304</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> All unique value(s) and frequency in the result (as the conditions require just one of the columns containing target values; irrelevant values may come from other vars columns): </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  304 3040 3041 3042 3043 3044 3045 3046 3047 3048 3049  305 3050 3051 3052 3053 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3054 3055 3056 3057 3058 3059  999 NA's </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1    1    1    1    1    1    1    1 </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → --------------No. rows restriction--------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">ℹ</span> Of the 29 clients in the input, 20 were flagged as 0 by restricting that each client must have at least 2 records </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → -------------- Output all records--------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Actions for definition SUD using source df2:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → --------------Inclusion step--------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">ℹ</span> Identify records with condition(s):</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> where at least one of the diagx, diagx_1, diagx_2 column(s) in each record</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> contains a value satisfied regular expression: ^305</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> All unique value(s) and frequency in the result (as the conditions require just one of the columns containing target values; irrelevant values may come from other vars columns): </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  304 3040 3041 3042 3043 3045 3046 3047 3048 3049  305 3050 3051 3052 3053 3054 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1    1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3055 3056 3057 3058 3059  999 NA's </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1    1    1    1    1    1    1 </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → --------------No. rows restriction--------------</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">ℹ</span> Of the 24 clients in the input, 21 were flagged as 0 by restricting that each client must have at least 3 records </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> → -------------- Output all records--------------</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># pool results from src1 and src2 together at client level</span></span></span>
<span class="r-in"><span><span class="fu">pool_case</span><span class="op">(</span><span class="va">sud_by_src</span>, <span class="va">sud_def</span>, output_lvl <span class="op">=</span> <span class="st">"clnt"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 12 × 6</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    def   clnt_id raw_in_src1 raw_in_src2 valid_in_src1 valid_in_src2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> SUD         1           0           1             0             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> SUD         4           1           1             1             0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> SUD         7           1           0             1             0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> SUD        20           0           1             0             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> SUD        21           1           1             1             0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> SUD        22           1           0             1             0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> SUD        23           1           1             1             0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> SUD        25           1           0             1             0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> SUD        29           1           0             1             0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> SUD        34           1           1             0             1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">11</span> SUD        39           1           1             1             0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">12</span> SUD        42           1           1             1             0</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kevin Hu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

