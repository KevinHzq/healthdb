<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Designed for identifying disease cases from admin data for epidemiological studies. The implementation focused on code readability and re-usability.">
<title>Overdose Cohort Team In-house Functions • odcfun</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Overdose Cohort Team In-house Functions">
<meta property="og:description" content="Designed for identifying disease cases from admin data for epidemiological studies. The implementation focused on code readability and re-usability.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">odcfun</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/Intro.html">Intro</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/KevinHzq/odcfun/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="odcfun">odcfun<a class="anchor" aria-label="anchor" href="#odcfun"></a>
</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<p>The goal of odcfun is to implement disease/event identification algorithms from administrative database for epidemiological studies. The implementation focused on code readability and re-usability.</p>
<p>Administrative health data data are often stored on database with strict security measures which may disable permission to write temporary tables. Writing queries without being able to cache intermediate results is challenging, especially when the data is too large to be downloaded from database into R (i.e., local memory) without some filtering process.</p>
<p>This package leverages <code>dbplyr</code>, particularly its ability to chain subqueries, in order to implement a common disease definition as one-shot big query. Common definitions often are in the form of having n primary care/hospitalization/prescription records with some International Classification of Diseases (ICD) codes within some time span.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of odcfun from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"KevinHzq/odcfun"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>This is a basic example which shows you how to solve a common problem:</p>
<p>Case definition: One or more hospitalization with a substance use disorder (SUD) diagnostic code, OR Two or more physician claims with a substance use disorder diagnostic code within one year.</p>
<p>We are going to implement this definition. First, let’s make a demo data sets for the two sources:</p>
<p>Physician claims</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/KevinHzq/odcfun" class="external-link">odcfun</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make_test_dat() makes either a toy data.frame or database table in memory with known number of rows that satisfy the query we will show later</span></span>
<span><span class="va">claim_db</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/make_test_dat.html">make_test_dat</a></span><span class="op">(</span>vals_kept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"303"</span>, <span class="st">"304"</span>, <span class="st">"305"</span>, <span class="st">"291"</span>, <span class="st">"292"</span>, <span class="fu">str_glue</span><span class="op">(</span><span class="st">"30{30:59}"</span><span class="op">)</span>, <span class="fu">str_glue</span><span class="op">(</span><span class="st">"29{10:29}"</span><span class="op">)</span>, noise_val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"999"</span>, <span class="st">"111"</span><span class="op">)</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"database"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># this is a database table</span></span>
<span><span class="co"># note that in-memory SQLite database stores dates as numbers</span></span>
<span><span class="va">claim_db</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Source:   SQL [6 x 6]</span></span>
<span><span class="co">#&gt; # Database: sqlite 3.43.2 [:memory:]</span></span>
<span><span class="co">#&gt;     uid clnt_id dates diagx diagx_1 diagx_2</span></span>
<span><span class="co">#&gt;   &lt;int&gt;   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;  </span></span>
<span><span class="co">#&gt; 1    51       1 16660 999   999     999    </span></span>
<span><span class="co">#&gt; 2    24       1 17464 3048  3040    &lt;NA&gt;   </span></span>
<span><span class="co">#&gt; 3    14       2 17640 3041  3047    &lt;NA&gt;   </span></span>
<span><span class="co">#&gt; 4    37       3 16948 2913  3035    999    </span></span>
<span><span class="co">#&gt; 5    91       4 16712 999   999     999    </span></span>
<span><span class="co">#&gt; 6    82       4 16760 999   999     &lt;NA&gt;</span></span></code></pre></div>
<p>Hospitalization</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hosp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/make_test_dat.html">make_test_dat</a></span><span class="op">(</span>vals_kept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">str_glue</span><span class="op">(</span><span class="st">"F{10:19}"</span><span class="op">)</span>, <span class="fu">str_glue</span><span class="op">(</span><span class="st">"F{100:199}"</span><span class="op">)</span>, noise_val <span class="op">=</span> <span class="st">"999"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"data.frame"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># this is a local data.frame/tibble</span></span>
<span><span class="va">hosp_df</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   uid clnt_id      dates diagx diagx_1 diagx_2</span></span>
<span><span class="co">#&gt; 1  43       1 2015-08-13  F156    F144    F168</span></span>
<span><span class="co">#&gt; 2  16       1 2017-10-25   F12    F132    &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3   6       2 2018-04-19  F133    F128    &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4  29       3 2016-05-27  F130    F164     999</span></span>
<span><span class="co">#&gt; 5  83       4 2015-10-04   999     999    &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 6  74       4 2015-11-21   999    &lt;NA&gt;     999</span></span></code></pre></div>
<p>Here’s how you could use <code>odcfun</code> to implement the SUD definition above:</p>
<ol style="list-style-type: decimal">
<li>
<p>Identify rows contains the target codes in the claim database</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result1</span> <span class="op">&lt;-</span> <span class="va">claim_db</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/identify_rows.html">identify_rows</a></span><span class="op">(</span></span>
<span>vars <span class="op">=</span> <span class="fu">starts_with</span><span class="op">(</span><span class="st">"diagx_"</span><span class="op">)</span>,</span>
<span>match <span class="op">=</span> <span class="st">"start"</span>,</span>
<span>vals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">291</span><span class="op">:</span><span class="fl">292</span>, <span class="fl">303</span><span class="op">:</span><span class="fl">305</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Identify records with condition(s): </span></span>
<span><span class="co">#&gt;  - where at least one of the diagx_1, diagx_2 column(s) in each record </span></span>
<span><span class="co">#&gt;    - contains a value satisfied SQL LIKE pattern: 291% OR 292% OR 303% OR 304% OR 305% </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To see the final query generated by 'dbplyr', use dplyr::show_query() on the output. </span></span>
<span><span class="co">#&gt; To extract the SQL string, use dbplyr::remote_query().</span></span></code></pre></div>
</li>
<li>
<p>Restrict the number of records per client</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result2</span> <span class="op">&lt;-</span> <span class="va">result1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="reference/restrict_n.html">restrict_n</a></span><span class="op">(</span></span>
<span>  clnt_id <span class="op">=</span> <span class="va">clnt_id</span>,</span>
<span>  n_per_clnt <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  count_by <span class="op">=</span> <span class="va">dates</span>,</span>
<span>  <span class="co"># here we use filter mode to remove records that failed the restriction</span></span>
<span>  mode <span class="op">=</span> <span class="st">"filter"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Apply restriction that each client must have at least 2 records with distinct dates. Clients/groups whichdid not meetthe condition were excluded.</span></span>
<span><span class="va">result2</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Source:     SQL [6 x 7]</span></span>
<span><span class="co">#&gt; # Database:   sqlite 3.43.2 [:memory:]</span></span>
<span><span class="co">#&gt; # Ordered by: dates</span></span>
<span><span class="co">#&gt;     uid clnt_id dates diagx diagx_1 diagx_2 flag_restrict_n</span></span>
<span><span class="co">#&gt;   &lt;int&gt;   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;             &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1    35       7 16810 2913  2923    999                   1</span></span>
<span><span class="co">#&gt; 2    22       7 16897 3056  2917    999                   1</span></span>
<span><span class="co">#&gt; 3    47       7 17096 3033  3051    3036                  1</span></span>
<span><span class="co">#&gt; 4    10       7 17250 2923  3057    999                   1</span></span>
<span><span class="co">#&gt; 5    41      10 16954 3033  305     2929                  1</span></span>
<span><span class="co">#&gt; 6    44      10 17788 999   304     292                   1</span></span></code></pre></div>
</li>
<li>
<p>Restrict the temporal pattern of diagnoses</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result3</span> <span class="op">&lt;-</span> <span class="va">result2</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="reference/restrict_dates.html">restrict_dates</a></span><span class="op">(</span></span>
<span>  clnt_id <span class="op">=</span> <span class="va">clnt_id</span>,</span>
<span>  date_var <span class="op">=</span> <span class="va">dates</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  within <span class="op">=</span> <span class="fl">365</span>,</span>
<span>  uid <span class="op">=</span> <span class="va">uid</span>,</span>
<span>  <span class="co"># here we use flag mode to flag records that met the restriction instead of removing those</span></span>
<span>  mode <span class="op">=</span> <span class="st">"flag"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Apply restriction that each client must have 2 records that were  within 365 days. Records that met the condition were flagged.</span></span>
<span><span class="va">result3</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Source:     SQL [6 x 8]</span></span>
<span><span class="co">#&gt; # Database:   sqlite 3.43.2 [:memory:]</span></span>
<span><span class="co">#&gt; # Ordered by: dates, uid</span></span>
<span><span class="co">#&gt;     uid clnt_id dates diagx diagx_1 diagx_2 flag_restrict_n flag_restrict_dates</span></span>
<span><span class="co">#&gt;   &lt;int&gt;   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;             &lt;int&gt;               &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1    35       7 16810 2913  2923    999                   1                   1</span></span>
<span><span class="co">#&gt; 2    22       7 16897 3056  2917    999                   1                   1</span></span>
<span><span class="co">#&gt; 3    47       7 17096 3033  3051    3036                  1                   1</span></span>
<span><span class="co">#&gt; 4    10       7 17250 2923  3057    999                   1                   0</span></span>
<span><span class="co">#&gt; 5    41      10 16954 3033  305     2929                  1                   0</span></span>
<span><span class="co">#&gt; 6    44      10 17788 999   304     292                   1                   0</span></span></code></pre></div>
</li>
<li><p>Repeat these steps for hospitalization and row bind the results.</p></li>
</ol>
<p>See the “Intro” vignette (<code><a href="articles/Intro.html">vignette("Intro")</a></code>) for detail and functions for batch execution (the ‘Call-building functions’ section).</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/KevinHzq/odcfun/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/KevinHzq/odcfun/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing odcfun</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Kevin Hu <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Kevin Hu.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
